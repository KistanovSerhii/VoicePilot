<Window x:Class="VoicePilot.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VoicePilot.App"
        mc:Ignorable="d"
        Title="VoicePilot" Height="720" Width="1180"
        WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/wavesound.png">
    <Grid Margin="20" x:Name="MainGrid">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Системные команды -->
        <Border x:Name="SystemCommandsPanel" Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="2"
                Background="#FDFEFF"
                BorderBrush="#E0E5F2"
                BorderThickness="1"
                CornerRadius="12"
                Padding="16"
                Margin="0,0,0,16">
            <ItemsControl ItemsSource="{Binding SystemCommands}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,8,12,0"
                                Padding="18,12"
                                CornerRadius="12"
                                Background="#F4F6FB"
                                BorderBrush="#D7DBE8"
                                BorderThickness="1">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="#F4F6FB" />
                                    <Setter Property="BorderBrush" Value="#D7DBE8" />
                                    <Setter Property="BorderThickness" Value="1" />
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding IsCurrent}" Value="True" />
                                                <Condition Binding="{Binding Type}" Value="Activation" />
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Background" Value="#E5F4FF" />
                                            <Setter Property="BorderBrush" Value="#1890FF" />
                                            <Setter Property="BorderThickness" Value="2" />
                                        </MultiDataTrigger>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding IsCurrent}" Value="True" />
                                                <Condition Binding="{Binding Type}" Value="Silence" />
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Background" Value="#FFF6E3" />
                                            <Setter Property="BorderBrush" Value="#E68A00" />
                                            <Setter Property="BorderThickness" Value="2" />
                                        </MultiDataTrigger>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding IsCurrent}" Value="True" />
                                                <Condition Binding="{Binding Type}" Value="Resume" />
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Background" Value="#E8FCEB" />
                                            <Setter Property="BorderBrush" Value="#34C759" />
                                            <Setter Property="BorderThickness" Value="2" />
                                        </MultiDataTrigger>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding IsCurrent}" Value="True" />
                                                <Condition Binding="{Binding Type}" Value="Exit" />
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Background" Value="#FFE6EB" />
                                            <Setter Property="BorderBrush" Value="#FF4D67" />
                                            <Setter Property="BorderThickness" Value="2" />
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel>
                                <TextBlock Text="{Binding Title}"
                                           FontWeight="SemiBold"
                                           FontSize="16" />
                                <TextBlock Text="{Binding Keywords}"
                                           FontSize="12"
                                           Foreground="#6B7280"
                                           TextWrapping="Wrap"
                                           Margin="0,4,0,0" />
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>

        <!-- Команды -->
        <Grid x:Name="CommandsGrid" Grid.Column="0" Grid.Row="1" Margin="0,0,16,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <DockPanel Grid.Row="0" Margin="0,0,0,10">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                    <Button Content="Настройки"
                            Padding="16,6"
                            Margin="0,0,8,0"
                            Command="{Binding OpenSystemCommandSettingsCommand}" />
                    <Button Content="Ресурсы"
                            Padding="16,6"
                            Margin="0,0,8,0"
                            Command="{Binding OpenResourceManagerCommand}" />
                    <Button Content="Новая команда"
                            Padding="16,6"
                            Command="{Binding OpenCommandBuilderCommand}" />
                </StackPanel>
            </DockPanel>

            <DataGrid Grid.Row="1"
                      x:Name="ModuleDataGrid"
                      ItemsSource="{Binding CommandItems}"
                      SelectedItem="{Binding SelectedCommandItem, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      HeadersVisibility="Column"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      FontSize="14"
                      MouseDoubleClick="ModuleDataGrid_OnMouseDoubleClick">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Команда" Binding="{Binding CommandName}" Width="2*" />
                    <DataGridTextColumn Header="Автор" Binding="{Binding Author}" Width="*" />
                    <DataGridTextColumn Header="Фразы" Binding="{Binding Phrases}" Width="3*" />
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- Индикатор и журнал -->
        <Grid x:Name="LogPanel" Grid.Column="1" Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Border Margin="0,0,0,12" Padding="12" BorderBrush="#E0E5F2" BorderThickness="1" CornerRadius="10">
                <Image Source="{Binding ListeningIndicatorImage}"
                       Width="96"
                       Height="96"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       MouseLeftButtonDown="StatusImage_OnMouseLeftButtonDown"
                       Cursor="Hand" />
            </Border>

            <GroupBox Header="Журнал действий" FontSize="16" Grid.Row="1">
                <ListView ItemsSource="{Binding Logs}" FontSize="13">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Время" Width="120" DisplayMemberBinding="{Binding Timestamp, StringFormat=HH:mm:ss}" />
                            <GridViewColumn Header="Уровень" Width="100" DisplayMemberBinding="{Binding Level}" />
                            <GridViewColumn Header="Сообщение" Width="330" DisplayMemberBinding="{Binding Message}" />
                        </GridView>
                    </ListView.View>
                </ListView>
            </GroupBox>
        </Grid>
    </Grid>
</Window>
