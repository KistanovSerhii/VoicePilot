# VoicePilot – голосовой ассистент для Windows

VoicePilot – это новая версия голосового ассистента, которая позволяет управлять Windows‑компьютером через микрофон. 
Приложение поддерживает модульные команды, сценарии на базе архивов и предназначено для пользователей, которым удобно или необходимо 
работать без клавиатуры и мыши.

## Основные возможности
- офлайн‑распознавание речи на базе Vosk (поддержка русского языка);
- слово активации, режим «тишины», команда завершения;
- загрузка команд из модулей (архивов) с манифестом `manifest.json` или `manifest.xml`;
- выполнение действий: запуск программ, сочетание клавиш, набор текста, перемещение мыши (в том числе непрерывное), клики,
  открытие URL и пользовательских ресурсов, сценарии `.bat`/`.ps1` и др.;
- реестр пользовательских ресурсов (`config/resources.json`) — позволяет по голосу открывать нужные папки и приложения;
- графический интерфейс для наблюдения за состоянием распознавания, журналом и установленными модулями;
- синтез речи для обратной связи (например, когда команда не найдена).

## Требования
- Windows 10/11 x64;
- .NET Runtime 9.0 (для разработки — .NET SDK 9.0+);
- микрофон и доступ к звуковой подсистеме;
- офлайн‑модель Vosk (например `vosk-model-small-ru-0.22`).

### Установка модели Vosk
1. Скачайте модель с сайта проекта: https://alphacephei.com/vosk/models
2. Распакуйте каталог модели в папку `VoicePilot/models`. В результате должен существовать путь, совпадающий со значением `speech:modelPath`
   в файле `config/appsettings.json` (по умолчанию `models/vosk-model-small-ru-0.22`).

## Запуск
```
cd VoicePilot
 dotnet build
 dotnet run --project src/VoicePilot.App
```
При первом запуске убедитесь, что микрофон доступен приложению. Если модель не найдена, в журнале появится предупреждение
и распознавание не стартует.

## Структура проекта
```
VoicePilot/
 ├─ config/             – общие настройки и системные команды
 ├─ Modules/            – каталоги с установленными командами
 ├─ src/VoicePilot.App/ – WPF-приложение
 │   ├─ Configuration/  – настройки и параметры путей
 │   ├─ Modules/        – обработка модулей и действий
 │   ├─ Recognition/    – фоновая служба распознавания речи
 │   ├─ Services/       – системные команды, TTS, исполнение
 │   ├─ Input/          – управление мышью/клавиатурой
 │   ├─ ViewModels/     – модель представления
 │   └─ Themes/         – ресурсы интерфейса
 └─ README.md – этот файл
```

## Модуль команд
Модуль представляет собой папку или архив (`.zip`) со структурой:
```
my-module/
 ├─ manifest.json        или manifest.xml
 └─ scripts/...          (опционально)
```
Пример `manifest.json`:
```json
{
  "id": "system.basics",
  "name": "Базовые команды",
  "version": "1.0.0",
  "culture": "ru-RU",
  "author": "Codex",
  "commands": [
    {
      "id": "open_notepad",
      "phrases": ["открой блокнот", "запусти блокнот"],
      "actions": [
        {
          "type": "runProcess",
          "parameters": { "path": "notepad.exe" }
        }
      ]
    }
  ],
  "resources": [
    {
      "key": "фильмы",
      "path": "%USERPROFILE%\\Videos",
      "type": "Folder"
    }
  ]
}
```

### Поддерживаемые типы действий (type)
| Тип               | Назначение/параметры                                               |
|-------------------|----------------------------------------------------------------------|
| `runProcess`      | `path`, `arguments`, `workingDirectory`                              |
| `shell`           | `command`, опционально `shell`, `arguments` (шаблон)                 |
| `script`          | `path` до `.bat`, `.cmd`, `.ps1` или исполняемого файла              |
| `sendKeys`        | `keys`: массив токенов (`ALT`, `TAB`, `CTRL`, `A`, `1` и т.д.)       |
| `typeText`        | `text` — вводит строку                                               |
| `mouseMove`       | `dx`, `dy`, `continuous` (bool), `intervalMs`                        |
| `mouseStop`       | останавливает непрерывное движение                                   |
| `mouseClick`      | `button`: `left`/`right`/`middle`, `double`                          |
| `openUrl`         | `url` — открыть ссылку в браузере                                    |
| `openResource`    | `key` — идентификатор из `resources.json` или манифеста              |
| `speak`           | `text` — озвучить сообщение                                          |
| `pause`           | `milliseconds` или `seconds` — пауза                                 |
| вложенные `actions` | позволяет строить последовательности (группа `actions` внутри действия) |

Параметры допускают строковые значения; относительные пути интерпретируются относительно каталога модуля.

### Создание архива команды
1. Подготовьте папку с манифестом и необходимыми файлами (скрипты и пр.).
2. Запакуйте в `.zip` (корень архива должен содержать `manifest.json`/`manifest.xml`).
3. В приложении нажмите **«Импорт команды»** и выберите архив. Модуль появится в списке и будет активирован сразу после распаковки.

## Системные команды
Файл `config/system-commands.json` содержит слова для активации, отключения, выхода и возобновления. 
Пример по умолчанию:
```json
{
  "activation": ["командир", "слушай"],
  "silence": ["тишина", "не слушай"],
  "resume": ["возобнови", "слушай дальше"],
  "exit": ["выход", "заверши работу"]
}
```
Можно дополнять списки своими фразами.

## Реестр ресурсов
`config/resources.json` — набор пользовательских путей. 
Команда с действием `openResource` может открывать или озвучивать эти ресурсы, 
что удобно для быстрого доступа к фильмам, музыке, документам и т.п.

## Отладка и журнал
На главном экране отображается состояние ассистента и список последних событий. 
Если модель не найдена или модуль содержит ошибки — проверьте журнал.

## Исправление загрузки модулей при запуске
**Симптом.** После удаления вспомогательных папок `Modules` внутри `src/VoicePilot.App` и `bin/...` список команд в приложении перестал отображаться при старте. Команды появлялись только после ручного импорта новой команды.

**Причина.** Настройка путей использовала первую найденную папку `Modules` относительно каталога выполнения (`AppContext.BaseDirectory`). В сборках Debug это значение указывало на `src/VoicePilot.App/bin/...`, поэтому при отсутствии локальной копии каталога загрузчик модулей считал, что модулей нет, даже если они находились в корневой папке репозитория `VoicePilot/Modules`.

**Решение.** Метод `FindSolutionRoot` в `Configuration/PathOptions.cs` обновлён: он сначала ищет каталог с файлом `VoicePilot.sln`, и только если решение не найдено, возвращает ближайший каталог, содержащий `Modules`. Благодаря этому приложение снова привязывается к общей папке `VoicePilot/Modules`, и список команд заполняется автоматически при запуске.

## Дальнейшие идеи
- словари для диктовки текста;
- веб‑интерфейс настройки (по мотивам исходных требований);
- тонкая настройка чувствительности и обработки команд;
- визуальные подсказки активного режима;
- дополнительные действия (HTTP-запросы, автоматизация приложений и т.д.).

---
Проект предназначен как расширяемая платформа: добавляйте свои модули, делитесь 
архивами с другими пользователями и настраивайте VoicePilot под конкретные рабочие сценарии.
